<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mountain Bike 3D</title>
<style>
html,body { margin:0; padding:0; overflow:hidden; font-family:Arial,sans-serif; }
canvas { display:block; background: linear-gradient(to top,#4CAF50,#87CEEB);}
.ui-overlay{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;justify-content:center;align-items:center;}
.menu, .bike-select, .map-select, .trail-select { background:white;border-radius:12px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,0.3); max-width:600px;width:90%; }
.grid{display:grid; gap:12px;}
.grid-2{grid-template-columns:repeat(2,1fr);}
.grid-1{grid-template-columns:1fr;}
button{padding:12px;border-radius:8px;border:2px solid #888;background:#fff; cursor:pointer; font-weight:bold;}
button:hover{border-color:#4CAF50;}
.trail-preview{height:40px;background:#ccc;margin-top:4px;border-radius:4px;position:relative;}
.trail-marker{width:8px;height:8px;position:absolute;border-radius:50%;top:16px;}
.easy{background:green;}
.medium{background:blue;}
.hard{background:black;}
</style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<div class="ui-overlay" id="uiOverlay">
<div class="menu" id="menuScreen">
<h1>Mountain Bike 3D</h1>
<p style="text-align:center;">Ride the mountain trails in first person!</p>
<button onclick="startBikeSelect()">Start Game</button>
</div>

<div class="bike-select" id="bikeSelectScreen" style="display:none;">
<h2>Select Your Bike</h2>
<div class="grid grid-2" id="bikeGrid"></div>
<button onclick="backToMenu()">Exit</button>
</div>

<div class="map-select" id="mapSelectScreen" style="display:none;">
<h2>Select Your Mountain</h2>
<div class="grid grid-1" id="mapGrid"></div>
<button onclick="backToBikes()">Back</button>
<button onclick="backToMenu()">Exit</button>
</div>

<div class="trail-select" id="trailSelectScreen" style="display:none;">
<h2>Select a Trail</h2>
<div class="grid grid-1" id="trailGrid"></div>
<button onclick="backToMaps()">Back</button>
<button onclick="backToMenu()">Exit</button>
</div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let selectedBike=null, selectedMap=null, selectedTrail=null;
const keys={};
window.addEventListener('keydown',e=>keys[e.key]=true);
window.addEventListener('keyup',e=>keys[e.key]=false);

// Bikes
const bikes=[
{id:1,name:'Trail Blazer',color:'#FF0000',speed:1.0,handling:0.8,jump:0.7},
{id:2,name:'Mountain King',color:'#0000FF',speed:0.9,handling:1.0,jump:0.8},
{id:3,name:'Rock Rider',color:'#00FF00',speed:1.2,handling:0.7,jump:0.6}
];

// Maps & Trails with obstacles
const maps=[
{id:1,name:'Pine Hills',groundColor:'#8B4513',skyColor:'#87CEEB',dirtColor:'#A0522D',trails:[
{ id:1,name:'Easy Pine 1',length:500,difficulty:'easy',obstacles:[{x:10,z:50,r:2},{x:-4,z:100,r:2}],trees:[{x:-2,z:60},{x:4,z:120}] },
{ id:2,name:'Easy Pine 2',length:550,difficulty:'easy',obstacles:[{x:0,z:80,r:2}],trees:[{x:-3,z:90},{x:3,z:130}] },
{ id:3,name:'Medium Pine 1',length:600,difficulty:'medium',obstacles:[{x:-1,z:70,r:3},{x:2,z:150,r:3}],trees:[{x:-3,z:100},{x:3,z:200}] },
{ id:4,name:'Medium Pine 2',length:650,difficulty:'medium',obstacles:[{x:0,z:120,r:3}],trees:[{x:-4,z:140},{x:4,z:220}] },
{ id:5,name:'Hard Pine 1',length:700,difficulty:'hard',obstacles:[{x:-2,z:150,r:4},{x:2,z:250,r:4}],trees:[{x:-3,z:160},{x:3,z:260}] },
{ id:6,name:'Hard Pine 2',length:750,difficulty:'hard',obstacles:[{x:0,z:180,r:4}],trees:[{x:-4,z:190},{x:4,z:280}] }
]}];

// UI navigation
function startBikeSelect(){ document.getElementById('menuScreen').style.display='none';
const grid=document.getElementById('bikeGrid'); grid.innerHTML='';
bikes.forEach(b=>{ const btn=document.createElement('button');
btn.innerHTML=`<div style="width:32px;height:32px;background:${b.color};border-radius:50%;margin:auto;"></div>
<div>${b.name}</div><div>Speed:${'⭐'.repeat(Math.ceil(b.speed*3))}</div>
<div>Handling:${'⭐'.repeat(Math.ceil(b.handling*3))}</div>
<div>Jump:${'⭐'.repeat(Math.ceil(b.jump*3))}</div>`; btn.onclick=()=>{selectedBike=b;startMapSelect();};
grid.appendChild(btn);});
document.getElementById('bikeSelectScreen').style.display='block';}

function startMapSelect(){ document.getElementById('bikeSelectScreen').style.display='none';
const grid=document.getElementById('mapGrid'); grid.innerHTML='';
maps.forEach(m=>{ const btn=document.createElement('button'); btn.textContent=m.name;
btn.onclick=()=>{selectedMap=m; startTrailSelect();}; grid.appendChild(btn);});
document.getElementById('mapSelectScreen').style.display='block';}

function startTrailSelect(){ document.getElementById('mapSelectScreen').style.display='none';
const grid=document.getElementById('trailGrid'); grid.innerHTML='';
selectedMap.trails.forEach(t=>{ const btn=document.createElement('button');
btn.innerHTML=`<div>${t.name} • ${t.length}m • ${t.difficulty.toUpperCase()}</div>
<div class="trail-preview"><div class="trail-marker ${t.difficulty}" style="left:${Math.random()*80}%"></div></div>`;
btn.onclick=()=>{selectedTrail=t; startGame();}; grid.appendChild(btn);});
document.getElementById('trailSelectScreen').style.display='block';}

function backToMenu(){ document.getElementById('bikeSelectScreen').style.display='none';
document.getElementById('mapSelectScreen').style.display='none';
document.getElementById('trailSelectScreen').style.display='none';
document.getElementById('menuScreen').style.display='block';}
function backToBikes(){ document.getElementById('mapSelectScreen').style.display='none'; document.getElementById('bikeSelectScreen').style.display='block'; }
function backToMaps(){ document.getElementById('trailSelectScreen').style.display='none'; document.getElementById('mapSelectScreen').style.display='block'; }

// Game state
const game={player:{x:0,y:2,z:0,vx:0,vy:0,vz:5,rotY:0,rotVel:0,onGround:true,distance:0},crashed:false,finished:false,time:0};

function startGame(){
document.getElementById('uiOverlay').style.display='none';

function gameLoop(){
  game.time+=0.016;

  // Controls
  const turnSpeed=0.04;
  if(keys['ArrowLeft']||keys['a']||keys['A']){game.player.rotVel+=turnSpeed;game.player.vx+=0.08*selectedBike.handling;}
  if(keys['ArrowRight']||keys['d']||keys['D']){game.player.rotVel-=turnSpeed;game.player.vx-=0.08*selectedBike.handling;}
  if(keys[' ']&&game.player.onGround){game.player.vy=7*selectedBike.jump;game.player.onGround=false;}

  // Physics
  game.player.vz = Math.max(3,Math.min(game.player.vz*selectedBike.speed,30));
  game.player.rotY += game.player.rotVel;
  game.player.rotVel*=0.9; game.player.vx*=0.95;

  const moveX = Math.sin(game.player.rotY)*game.player.vz*0.016+game.player.vx*0.016;
  const moveZ = Math.cos(game.player.rotY)*game.player.vz*0.016;
  game.player.x+=moveX; game.player.z+=moveZ;
  game.player.vy -= 0.6; game.player.y += game.player.vy*0.016;

  // Terrain & collision
  let onGround=false;
  const trailWidth=5;
  if(Math.abs(game.player.x)>trailWidth) game.crashed=true;

  selectedTrail.obstacles.forEach(o=>{
    const dx=game.player.x-o.x; const dz=game.player.z-o.z;
    if(Math.sqrt(dx*dx+dz*dz)<o.r) game.crashed=true;
  });

  // Trees collision optional (could just render)
  selectedTrail.trees.forEach(tree=>{
    const dx=game.player.x-tree.x; const dz=game.player.z-tree.z;
    if(Math.sqrt(dx*dx+dz*dz)<1) game.crashed=true;
  });

  if(game.player.y<2){ game.player.y=2; game.player.vy=0; onGround=true; game.player.onGround=true; }

  // Render
  ctx.fillStyle=selectedMap.skyColor; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle=selectedMap.groundColor;
  ctx.fillRect(0,canvas.height/2,canvas.width,canvas.height/2);

  // Draw trail
  ctx.strokeStyle='#654321'; ctx.lineWidth=trailWidth*20; ctx.beginPath();
  ctx.moveTo(canvas.width/2-trailWidth*10,canvas.height/2); ctx.lineTo(canvas.width/2+trailWidth*10,canvas.height/2+canvas.height/2); ctx.stroke();

  // Draw obstacles
  selectedTrail.obstacles.forEach(o=>{
    const scale = 5/(o.z - game.player.z +50);
    const screenX = canvas.width/2 + (o.x - game.player.x)*scale*50;
    const screenY = canvas.height/2 + (o.z - game.player.z)*scale*50;
    ctx.fillStyle='red'; ctx.beginPath(); ctx.arc(screenX,screenY,10*scale,0,Math.PI*2); ctx.fill();
  });

  // Draw trees
  selectedTrail.trees.forEach(t=>{
    const scale = 5/(t.z - game.player.z +50);
    const screenX = canvas.width/2 + (t.x - game.player.x)*scale*50;
    const screenY = canvas.height/2 + (t.z - game.player.z)*scale*50;
    ctx.fillStyle='green'; ctx.fillRect(screenX-5*scale,screenY-10*scale,10*scale,20*scale);
  });

  // HUD
  ctx.fillStyle='rgba(0,0,0,0.6)'; ctx.fillRect(10,10,280,110);
  ctx.fillStyle='#FFF'; ctx.font='bold 18px Arial';
  ctx.fillText(`Distance: ${Math.floor(game.player.z)}m / ${selectedTrail.length}m`,20,35);
  ctx.fillText(`Speed: ${Math.floor(game.player.vz*8)} km/h`,20,60);
  ctx.fillText(`Time: ${game.time.toFixed(1)}s`,20,85);
  ctx.fillText(`Air: ${game.player.onGround?'NO':'YES'}`,20,110);

  // End / crash
  if(game.crashed || game.player.z>=selectedTrail.length){
    ctx.fillStyle='rgba(0,0,0,0.8)'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle=game.crashed?'#FF0000':'#4CAF50';
    ctx.font='bold 60px Arial'; ctx.fillText(game.crashed?'CRASHED!':'FINISHED!',canvas.width/2-150,canvas.height/2-40);
    ctx.fillStyle='#FFF'; ctx.font='32px Arial';
    ctx.fillText(`Time: ${game.time.toFixed(2)}s`,canvas.width/2-90,canvas.height/2+20);
    ctx.font='28px Arial';
    ctx.fillText('Press R to retry',canvas.width/2-100,canvas.height/2+70);
    if(keys['r']||keys['R']) { game.crashed=false; game.player.x=0; game.player.y=2; game.player.z=0; game.time=0; }
  } else requestAnimationFrame(gameLoop);
}
requestAnimationFrame(gameLoop);
}
</script>
</body>
</html>
