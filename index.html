<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Bike Game</title>
<style>
  body { margin:0; font-family:sans-serif; overflow:hidden; background:#111; color:white; }
  .screen { display:none; width:100vw; height:100vh; justify-content:center; align-items:center; flex-direction:column; }
  .screen.active { display:flex; }
  .menu { display:flex; gap:20px; }
  .card { width:150px; height:100px; background:#333; display:flex; justify-content:center; align-items:center; cursor:pointer; border:2px solid white; transition:0.2s; }
  .card:hover { border-color:#ff0; }
  button { padding:10px 20px; margin:10px; cursor:pointer; }
  #gameUI { position:absolute; top:0; left:0; color:white; padding:10px; z-index:10; }
  #stats,#timer { font-size:16px; margin:5px; }
  #messageScreen { position:absolute; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); display:flex; flex-direction:column; justify-content:center; align-items:center; color:white; font-size:24px; z-index:20; }
</style>
</head>
<body>

<!-- Start Screen -->
<div id="startScreen" class="screen active">
  <h1>3D Bike Game</h1>
  <button id="startBtn">Start</button>
</div>

<!-- Bike Selection -->
<div id="bikeScreen" class="screen">
  <h2>Select Your Bike</h2>
  <div class="menu">
    <div class="card" data-bike="bike1">Bike 1</div>
    <div class="card" data-bike="bike2">Bike 2</div>
    <div class="card" data-bike="bike3">Bike 3</div>
  </div>
  <button class="backBtn">Back</button>
</div>

<!-- Map Selection -->
<div id="mapScreen" class="screen">
  <h2>Select Map</h2>
  <div class="menu">
    <div class="card" data-map="map1" style="background:green">Map 1</div>
    <div class="card" data-map="map2" style="background:blue">Map 2</div>
    <div class="card" data-map="map3" style="background:black">Map 3</div>
  </div>
  <button class="backBtn">Back</button>
</div>

<!-- Level Selection -->
<div id="levelScreen" class="screen">
  <h2>Select Level</h2>
  <div class="menu">
    <div class="card" data-level="easy" style="background:green">Easy</div>
    <div class="card" data-level="easy2" style="background:green">Easy2</div>
    <div class="card" data-level="medium" style="background:blue">Medium</div>
    <div class="card" data-level="medium2" style="background:blue">Medium2</div>
    <div class="card" data-level="hard" style="background:black">Hard</div>
    <div class="card" data-level="hard2" style="background:black">Hard2</div>
  </div>
  <button class="backBtn">Back</button>
</div>

<!-- Message Screen -->
<div id="messageScreen">
  <h2 id="messageTitle"></h2>
  <p id="messageText"></p>
  <button id="retryBtn">Retry</button>
</div>

<!-- Game Stats -->
<div id="gameUI">
  <div id="stats">Distance: 0m</div>
  <div id="timer">Time: 0s</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/PointerLockControls.js"></script>
<script>
// -------------------- SCREENS --------------------
const startScreen = document.getElementById('startScreen');
const bikeScreen = document.getElementById('bikeScreen');
const mapScreen = document.getElementById('mapScreen');
const levelScreen = document.getElementById('levelScreen');
const messageScreen = document.getElementById('messageScreen');
const retryBtn = document.getElementById('retryBtn');

let selectedBike, selectedMap, selectedLevel;
document.getElementById('startBtn').onclick = () => showScreen('bikeScreen');

function showScreen(screenId){
  startScreen.classList.remove('active');
  bikeScreen.classList.remove('active');
  mapScreen.classList.remove('active');
  levelScreen.classList.remove('active');
  messageScreen.style.display = 'none';
  if(screenId==='startScreen') startScreen.classList.add('active');
  if(screenId==='bikeScreen') bikeScreen.classList.add('active');
  if(screenId==='mapScreen') mapScreen.classList.add('active');
  if(screenId==='levelScreen') levelScreen.classList.add('active');
  if(screenId==='gameUI') document.getElementById('gameUI').style.display='block';
}

bikeScreen.querySelectorAll('.card').forEach(c=>{
  c.onclick = ()=>{ selectedBike=c.dataset.bike; showScreen('mapScreen'); }
});
mapScreen.querySelectorAll('.card').forEach(c=>{
  c.onclick = ()=>{ selectedMap=c.dataset.map; showScreen('levelScreen'); }
});
levelScreen.querySelectorAll('.card').forEach(c=>{
  c.onclick = ()=>{
    selectedLevel=c.dataset.level;
    initThree(); spawnTrail(); spawnObstacles(); showScreen('gameUI'); animate();
  }
});
document.querySelectorAll('.backBtn').forEach(b=>{
  b.onclick = ()=>showScreen('startScreen');
});
retryBtn.onclick = ()=>{ crashed=false; finished=false; player={x:0,y:1,z:0,vx:0,vy:0,rotY:0,rotVel:0,onGround:true,distance:0}; startTime=performance.now(); showScreen('gameUI'); };

// -------------------- 3D GAME --------------------
let scene, camera, renderer, controls;
let player = { x:0, y:1, z:0, vx:0, vy:0, rotY:0, rotVel:0, onGround:true, distance:0 };
let keys = {};
let clock = new THREE.Clock();
let obstacles = [];
let trailMesh;
let trailLength = 200;
let crashed = false;
let finished = false;
let startTime = performance.now();
let speed = 12;

function initThree(){
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x87ceeb);
  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight,0.1,1500);
  camera.position.set(player.x,player.y+1.5,player.z);

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth,window.innerHeight);
  document.body.appendChild(renderer.domElement);

  const light = new THREE.DirectionalLight(0xffffff,1);
  light.position.set(10,20,10);
  scene.add(light);
  scene.add(new THREE.AmbientLight(0xffffff,0.4));

  controls = new THREE.PointerLockControls(camera, renderer.domElement);
  scene.add(controls.getObject());
  renderer.domElement.addEventListener('click',()=>controls.lock());

  document.addEventListener('keydown',e=>{ keys[e.key.toLowerCase()]=true; if(e.key.toLowerCase()==='r'&&(crashed||finished)) restartGame(); });
  document.addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);

  window.addEventListener('resize',()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
  });
}

function spawnTrail(){
  const colors = {green:0x228B22, blue:0x1E90FF, black:0x000000};
  const color = colors['green']; // placeholder
  const geometry = new THREE.PlaneGeometry(6, trailLength, 32,32);
  const material = new THREE.MeshPhongMaterial({color:color});
  trailMesh = new THREE.Mesh(geometry,material);
  trailMesh.rotation.x=-Math.PI/2;
  trailMesh.position.z=trailLength/2;
  scene.add(trailMesh);
}

function spawnObstacles(){
  obstacles=[];
  for(let i=0;i<30;i++){
    const geom = new THREE.BoxGeometry(1,1,1);
    const mat = new THREE.MeshPhongMaterial({color:0x8B4513});
    const obj = new THREE.Mesh(geom,mat);
    obj.position.set(Math.random()*4-2,0.5,Math.random()*(trailLength-20)+20);
    scene.add(obj);
    obstacles.push(obj);
  }
}

function animate(){
  requestAnimationFrame(animate);
  const dt = clock.getDelta();
  if(!crashed&&!finished){
    handleControls(dt);
    camera.position.set(player.x,player.y+1.5,player.z);
    player.distance = player.z;
    document.getElementById('stats').innerText=`Distance: ${player.distance.toFixed(1)}m`;
    document.getElementById('timer').innerText=`Time: ${((performance.now()-startTime)/1000).toFixed(2)}s`;
    checkCollisions();
    if(player.z>=trailLength){ finished=true; showMessage('FINISHED!','You completed the trail!'); }
  }
  renderer.render(scene,camera);
}

function handleControls(dt){
  const turnSpeed=1.5,jumpPower=8;
  if(keys['arrowleft']||keys['a']) player.rotVel=turnSpeed*dt;
  if(keys['arrowright']||keys['d']) player.rotVel=-turnSpeed*dt;
  if(keys[' ']&&player.onGround){ player.vy=jumpPower; player.onGround=false; }
  player.rotY+=player.rotVel; player.rotVel*=0.9;
  if(keys['arrowup']||keys['w']){
    player.x+=Math.sin(player.rotY)*speed*dt;
    player.z+=Math.cos(player.rotY)*speed*dt;
  }
  player.vy-=20*dt; player.y+=player.vy*dt;
  if(player.y<=1){ player.y=1; player.vy=0; player.onGround=true; } else player.onGround=false;
}

function checkCollisions(){
  for(const obj of obstacles){
    const dx=obj.position.x-player.x;
    const dz=obj.position.z-player.z;
    const dist=Math.sqrt(dx*dx+dz*dz);
    if(dist<1.5){ crashed=true; showMessage('CRASHED!','You hit an obstacle!'); }
  }
}

function showMessage(title,text){
  document.getElementById('messageTitle').textContent=title;
  document.getElementById('messageText').textContent=text;
  messageScreen.style.display='flex';
}

function restartGame(){
  crashed=false; finished=false;
  player={x:0,y:1,z:0,vx:0,vy:0,rotY:0,rotVel:0,onGround:true,distance:0};
  startTime=performance.now();
  messageScreen.style.display='none';
}
</script>
</body>
</html>
